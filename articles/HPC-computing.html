<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Distributing jobs for high-performance computing (HPC) clusters (e.g., via Slurm) • SimDesign</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Distributing jobs for high-performance computing (HPC) clusters (e.g., via Slurm)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SimDesign</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.18</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Catch_errors.html">Managing warning and error messages</a></li>
    <li><a class="dropdown-item" href="../articles/Fixed_obj_fun.html">Exporting objects and functions from the workspace</a></li>
    <li><a class="dropdown-item" href="../articles/HPC-computing.html">Distributing jobs for high-performance computing (HPC) clusters (e.g., via Slurm)</a></li>
    <li><a class="dropdown-item" href="../articles/MultipleAnalyses.html">Multiple analysis functions</a></li>
    <li><a class="dropdown-item" href="../articles/Parallel-computing.html">Parallel computing information</a></li>
    <li><a class="dropdown-item" href="../articles/Saving-results.html">Saving simulation results and state</a></li>
    <li><a class="dropdown-item" href="../articles/SimDesign-intro.html">Introduction to the SimDesign package</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/philchalmers/SimDesign/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Distributing jobs for high-performance computing (HPC) clusters (e.g., via Slurm)</h1>
                        <h4 data-toc-skip class="author">Phil
Chalmers</h4>
            
            <h4 data-toc-skip class="date">2024-12-31</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/philchalmers/SimDesign/blob/main/vignettes/HPC-computing.Rmd" class="external-link"><code>vignettes/HPC-computing.Rmd</code></a></small>
      <div class="d-none name"><code>HPC-computing.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The purpose of this vignette is to demonstrate how to utilize
<code>SimDesign</code> in the context of distributing many jobs across
independent computing environments, such as high-performance computing
(HPC) clusters, in a way that allows for reproducibility of the
simulation conditions, resubmission of jobs in case of incomplete
collection of results within a specified HPC execution time budget, and
to ensure that random number generation across the entire simulation
(and subsequent resubmissions, if required) are properly manged
throughout given the batch nature of the job. The following text and
examples are primarily for managing larger simulations, often with
thousands of replications over many simulation conditions (i.e., rows in
the defined <code>design</code> object) which generally require
non-trivial amounts of computing resources to execute (hence, the need
for super-computing resources and job schedulers like Slurm, TORQUE,
MAUI, among others).</p>
<p>For information about Slurm’s Job Array support in particular, which
this vignette uses as an example, see <a href="https://slurm.schedmd.com/job_array.html" class="external-link uri">https://slurm.schedmd.com/job_array.html</a></p>
</div>
<div class="section level2">
<h2 id="standard-setup-on-hpc-cluster">Standard setup on HPC cluster<a class="anchor" aria-label="anchor" href="#standard-setup-on-hpc-cluster"></a>
</h2>
<p>To start, the structure of the simulation code used later on to
distribute the jobs to the HPC scheduler is effectively the same as the
usual generate-analyse-summarise workflow described in
<code><a href="../reference/runSimulation.html">runSimulation()</a></code>, with a few organizational exceptions. As
such, this is always a good place to start when designing, testing, and
debugging a simulation experiment before submitting to HPC clusters.</p>
<p><strong>IMPORTANT: Only after the vast majority of the bugs and
coding logic have been work out should you consider moving on to the
next step involving HPC clusters</strong>. If your code is not well
vetted in this step then any later jobs evaluated on the HPC cluster
will be a waste of time and resources (garbage-in, garbage-out).</p>
<div class="section level4">
<h4 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h4>
<p>Suppose the following simulation was to be evaluated, though for time
constraint reasons would not be possible to execute on a single computer
(or a smaller network of computers) and therefore should be submitted to
an HPC cluster.</p>
<p>The following script (hypothetically written in a file called
<code>SimDesign_simulation.R</code>) contains a simulation experiment
whose instructions are to be submitted to the Slurm scheduler. To do so,
the <code>sbatch</code> utility is used along with the set of
instructions specifying the type of hardware required in the file
<code>slurmInstructions.slurm</code>. In the R side of the simulation,
the defined code must grab all available cores (minus 1) that are
detectable via <code><a href="https://parallelly.futureverse.org/reference/availableCores.html" class="external-link">parallelly::availableCores()</a></code>, which occurs
automatically when using
<code>runSimulation(..., parallel=TRUE)</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># SimDesign::SimFunctions()</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://philchalmers.github.io/SimDesign/">SimDesign</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">Design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createDesign.html">createDesign</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Generate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">condition</span>, <span class="va">fixed_objects</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">condition</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="co"># distributed N(10, 5)</span></span>
<span>    <span class="va">dat</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Analyse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">condition</span>, <span class="va">dat</span>, <span class="va">fixed_objects</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, median<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span> <span class="co"># mean/median of sample data</span></span>
<span>    <span class="va">ret</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Summarise</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">condition</span>, <span class="va">results</span>, <span class="va">fixed_objects</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># standard setup (not ideal for HPC clusters as parallelization</span></span>
<span><span class="co">#  occurs within the design conditions, not across)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runSimulation.html">runSimulation</a></span><span class="op">(</span>design<span class="op">=</span><span class="va">Design</span>, replications<span class="op">=</span><span class="fl">10000</span>, generate<span class="op">=</span><span class="va">Generate</span>,</span>
<span>                     analyse<span class="op">=</span><span class="va">Analyse</span>, summarise<span class="op">=</span><span class="va">Summarise</span>, parallel<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>                     filename<span class="op">=</span><span class="st">'mysim'</span><span class="op">)</span></span></code></pre></div>
<p>In the standard <code>runSimulation(..., parallel=TRUE)</code> setup
the 10,000 replications would be distributed to the available computing
cores and evaluated independently across the three row conditions in the
<code>design</code> object. However, this process is only executed in
sequence: <code>design[1, ]</code> is evaluated first and, only after
the 10,000 replications are collected, <code>design[2, ]</code> is
evaluated until it is complete, then <code>design[3, ]</code>, and so
on.</p>
<p>As well, in order for this approach to be at all optimal the HPC
cluster must assign a job containing a very large number of resources;
specifically, higher RAM and CPUs. To demonstrate, in the following
<code>slurmInstructions.slurm</code> file a larger number of CPUs are
requested when allocating the computational structure/cluster associated
with this job, as well as larger amounts of RAM.</p>
<pre><code>#!/bin/bash
#SBATCH --job-name="My simulation (multiple CPUs)"
#SBATCH --mail-type=ALL
#SBATCH --mail-user=somewhere@out.there
#SBATCH --output=/dev/null    ## (optional) delete .out files
#SBATCH --time=12:00:00       ## HH:MM:SS
#SBATCH --cpus-per-task=96    ## Build a computer with 96 cores
#SBATCH --mem-per-cpu=2G      ## Build a computer with 192GB of RAM 

module load r
Rscript --vanilla SimDesign_simulation.R</code></pre>
<p>This job request a computing cluster be built with 192 GB of RAM with
96 CPUs (across whatever computing nodes are available; likely 2 or
more), which the <code>SimDesign_simulation.R</code> is evaluated in,
and is submitted to the scheduler via
<code>sbatch slurmInstructions.slurm</code>.</p>
</div>
<div class="section level4">
<h4 id="limitations">Limitations<a class="anchor" aria-label="anchor" href="#limitations"></a>
</h4>
<p>While generally effective at distributing the computational load,
there are a few limitations of the above approach:</p>
<ol style="list-style-type: decimal">
<li>For simulations with varying execution times this will create a
great deal of resource waste.
<ul>
<li>Due to the row-evaluation nature of the <code>design</code>
conditions, computing cores will at some point sit idle while waiting
for the remaining experiments to complete their job. This occurs for
each row in the <code>design</code> input (i.e., per simulation
condition)</li>
<li>As such, simulation experiments with many conditions to evaluate
will suffer most due to the rolling overhead, resulting in wasted
resource management (not kind to other users of the HPC cluster) and
ultimately results in jobs that take longer to complete</li>
</ul>
</li>
<li>Designers must first estimate the number of <em>total</em> amount of
CPUs/RAM/time required, while being as conservative as possible
<ul>
<li>Problematic because fewer resource jobs are given higher priority in
the scheduler, and because you may be taking resources away from other
researchers if the cores sit idle</li>
</ul>
</li>
<li>Parallel distribution across the allocated resources (e.g., across
two nodes, both with 48 cores) incurs some overhead that grows as a
function of the size of the defined cluster
<ul>
<li>Using a 96 CPU cluster will not result in a 96x speedup of a 1 CPU
job. In fact, the larger the allocated cluster, the worse the
performance efficiency</li>
</ul>
</li>
<li>The scheduler must wait until all resources (e.g., RAM and CPUs)
<em>simultaneously</em> become available to allocate the requested
specifications, which can take a good amount of time to allocate if the
resources requested are excessively high (hence, become low
<em>priority</em> on the scheduler)
<ul>
<li>If you request 96 CPUs with 192 GB of RAM then this will take
considerably longer to allocate compared to requesting 96 independent
computing arrays with 1 CPU and 2 GB of RAM (the latter approach is
described in the next section)</li>
<li>In concert with point 3), this results in jobs that a) take longer
to get started as they will sit longer in the queue and b) may not
distribute the load efficiently enough, thereby resulting in larger wall
time then should have been necessary</li>
</ul>
</li>
<li>Submitting independent multiple batches to the cluster makes it more
difficult to guarantee the quality of the random numbers
<ul>
<li>Setting the <code>seed</code> for each condition ensure that within
each <code>design</code> condition the random numbers are high quality,
however there is no guarantee that repeated use of
<code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> will result in high-quality random numbers (see
next section for example)</li>
<li>Hence, repeated job submissions of this type, even with unique seeds
per condition, may not generate high quality numbers if repeated too
many times (alternative is to isolate each <code>design</code> row and
submit each row as a unique job, which is demonstrated near the end of
this vignette)</li>
</ul>
</li>
<li>Finally, and perhaps most problematic in simulation experiment
applications, schedulers frequently cap the maximum number of resources
that can be requested (e.g., 256 GB of RAM, 200 CPUs), which limits the
application of large RAM and CPU jobs
<ul>
<li>Note that to avoid wasting time by swapping/paging, schedulers will
never allocate jobs whose memory requirements exceed the amount of
available memory</li>
</ul>
</li>
</ol>
<p>To address these and other computational inefficiencies/wasted
resources, one can instead switch from the cluster-based approach above
to an <em>array</em> distribution approach, discussed in the next
section.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="array-jobs">Array jobs<a class="anchor" aria-label="anchor" href="#array-jobs"></a>
</h2>
<p>For HPC computing it is often more optimal to distribute both
replications <em>and</em> conditions simultaneously to unique computing
nodes (termed <strong>arrays</strong>) to effectively break the problem
in several mini-batches (e.g., split the simulation into 1000+
independent pieces, and collect the results later). As such, the above
<code>design</code> object and <code><a href="../reference/runSimulation.html">runSimulation()</a></code> structure
above does not readily lend itself to optimal distribution for the array
scheduler to manage. Nevertheless, the core components are still useful
for initial code design, testing, and debugging, and therefore serve as
a necessary first step when writing simulation experiment code prior to
submitting to an HPC cluster.</p>
<p>After defining and testing your simulation to ensure that it works as
expected, it now comes the time to setup the components required for
organizing the HPC cluster submission using the
<code><a href="../reference/runArraySimulation.html">runArraySimulation()</a></code> function.</p>
<div class="section level3">
<h3 id="converting-runsimulation-workflow-to-one-for-runarraysimulation">Converting <code>runSimulation()</code> workflow to one for
<code>runArraySimulation()</code><a class="anchor" aria-label="anchor" href="#converting-runsimulation-workflow-to-one-for-runarraysimulation"></a>
</h3>
<p>The job of <code><a href="../reference/runArraySimulation.html">runArraySimulation()</a></code> is to utilize the
relevant information defined in the <code>.sh</code> or
<code>.slurm</code> script. This is done by extracting information
provided by the scheduler (specifically, via an <code>arrayID</code>),
which is used to select specific subsets of the <code>design</code>
rows. However, unlike <code><a href="../reference/runSimulation.html">runSimulation()</a></code> the function
<code><a href="../reference/runArraySimulation.html">runArraySimulation()</a></code> has been designed to control important
information pertaining to <code>.Random.seeds</code> and other relevant
distribution information that allow for the rows in the
<code>design</code> object itself to contain <strong>repeated
experimental condition information</strong>. This allows both the
<code>design</code> rows <em>and</em> <code>replication</code>
information to be optimally distributed to the HPC cluster.</p>
<p>The following example presents the essential modifications required
to move from a single <code><a href="../reference/runSimulation.html">runSimulation()</a></code> workflow to a batch
workflow suitable for <code><a href="../reference/runArraySimulation.html">runArraySimulation()</a></code> and Slurm
scheduler.</p>
</div>
<div class="section level3">
<h3 id="expand-the-standard-simulation-design-object-for-each-array-id">Expand the standard simulation <code>design</code> object for each
array ID<a class="anchor" aria-label="anchor" href="#expand-the-standard-simulation-design-object-for-each-array-id"></a>
</h3>
<p>Suppose that 300 computing cores were independently available on the
HPC cluster, though the availability of these cores only trickle in as a
function of the schedulers decided availability. In this case, the
strategy would be to split up the <code>3 * 10000 = 30000</code>
condition-by-replications experiments across the gradually available
resources, where jobs are evaluated in parallel and at different
times.</p>
<p>Given the above specifications, you may decide that each of the 300
computing nodes requested to the scheduler should evaluate exactly 100
replications each (<code>nrow(design) * 10000 / 300 = 100</code>). In
this case, <code><a href="../reference/expandDesign.html">expandDesign()</a></code> is used to repeat each row
condition 100 times, creating a new <em>expanded</em>
<code>design</code> object with 300 rows instead of 3. To accommodate
for the new rows, the associated <code>replications</code> should now be
defined according to how many replications should be used within each of
these to-be-distributed conditions, which need not be equal (see
below).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rc</span> <span class="op">&lt;-</span> <span class="fl">100</span>   <span class="co"># number of times the design row was repeated</span></span>
<span><span class="va">Design300</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expandDesign.html">expandDesign</a></span><span class="op">(</span><span class="va">Design</span>, repeat_conditions <span class="op">=</span> <span class="va">rc</span><span class="op">)</span></span>
<span><span class="va">Design300</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 300 × 1</span></span></span>
<span><span class="co">##        N</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>    10</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 290 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># target replication number for each condition</span></span>
<span><span class="va">rep_target</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span></span>
<span><span class="co"># replications per row in Design300</span></span>
<span><span class="va">replications</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">rep_target</span>  <span class="op">/</span> <span class="va">rc</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Design300</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The above approach assumes that each <code>design</code> condition is
equally balanced in terms of computing time and resources, though if
this is not the case (e.g., the last condition contains notably higher
computing times than the first two conditions) then
<code>repeat_conditions</code> can be specified as a vector instead,
such as <code>repeat_conditions = c(100, 100, 1000)</code>, which for
the latter portion would be associated with a 10 replications per
distributed node instead of 100.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">DesignUnbalanced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expandDesign.html">expandDesign</a></span><span class="op">(</span><span class="va">Design</span>, repeat_conditions <span class="op">=</span> <span class="va">rc</span><span class="op">)</span></span>
<span><span class="va">DesignUnbalanced</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1,200 × 1</span></span></span>
<span><span class="co">##        N</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>    10</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1,190 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rep_target</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">replicationsUnbalanced</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">rep_target</span> <span class="op">/</span> <span class="va">rc</span>, times <span class="op">=</span> <span class="va">rc</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">replicationsUnbalanced</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 100 100 100 100 100 100</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">replicationsUnbalanced</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## replicationsUnbalanced</span></span>
<span><span class="co">##   10  100 </span></span>
<span><span class="co">## 1000  200</span></span></code></pre>
<p>Regardless of whether the expanded design is balanced or unbalanced
each row in the resulting expanded design object will be assigned to a
unique computing array node, identified according to the Slurm assigned
array ID.</p>
</div>
<div class="section level3">
<h3 id="construct-and-record-proper-random-seeds">Construct and record proper random seeds<a class="anchor" aria-label="anchor" href="#construct-and-record-proper-random-seeds"></a>
</h3>
<p>In principle, the expanded <code>Design300</code> object above could
be passed as
<code>runSimulation(Design300, replications=100, ...)</code> to evaluate
each of the repeated conditions, where each row is now replicated only
100 times. However, there is now an issue with respect to the random
seed management in that use of functions such as <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code>
and friends are no longer viable. This is because repeated use of
<code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> does not itself guarantee independent
high-quality random numbers between different instances. For
example,</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>           <span class="co">## seemingly independent</span></span></code></pre></div>
<p><img src="HPC-computing_files/figure-html/unnamed-chunk-6-1.png" width="480"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="va">y</span><span class="op">[</span><span class="op">-</span><span class="fl">100</span><span class="op">]</span><span class="op">)</span> <span class="co">## subsets perfectly correlated</span></span></code></pre></div>
<p><img src="HPC-computing_files/figure-html/unnamed-chunk-6-2.png" width="480"></p>
<p>This issue is generally not problem in the standard
<code><a href="../reference/runSimulation.html">runSimulation()</a></code> approach as within each design condition
high quality random numbers are used by default, and any potentially
repeated number sequences <em>across</em> the conditions are highly
unlikely to affect the quality of the overall simulation experiment (the
conditions themselves typically generate and manage random numbers in
different ways due to the varying simulation factors, such as sample
sizes, variance conditions, fitted models, number of variables, type of
probability distributions use, and so on). However, in the
<code><a href="../reference/expandDesign.html">expandDesign()</a></code> setup the likelihood of witnessing
correlated/redundant random samples increases very quickly, which is
particularly problematic within each distributed replication set; hence,
special care must be taken to ensure that proper seeds are distributed
to each job array.</p>
<p>Fortunately, seeds are easy to manage with the
<code><a href="../reference/genSeeds.html">genSeeds()</a></code> function using a two-step approach, which is
internally managed by <code><a href="../reference/runArraySimulation.html">runArraySimulation()</a></code> by supplying an
initial seed (<code>iseed</code>) value and the associated array ID
(<code>arrayID</code>). Doing so will utilize L’Ecuyer’s (1999) method,
which constructs sequentially computed <code>.Random.seed</code> states
to ensure independence across all replications and conditions. Note that
<code>iseed</code> must constant across all job arrays, so <strong>make
sure to define <code>iseed</code> once and only once</strong>!</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># genSeeds()   # do this once on the main node/home computer and store the number!</span></span>
<span><span class="va">iseed</span> <span class="op">&lt;-</span> <span class="fl">1276149341</span></span></code></pre></div>
<p>As discussed in the FAQ section at the bottom, this associated value
will also allow for generation of new <code>.Random.seed</code> elements
if (or when) a second or third set of simulation jobs should be
submitted to the HPC cluster at a later time but must also generate
simulated data that is independent from the initial submission(s).</p>
</div>
<div class="section level3">
<h3 id="extract-array-id-information-from-the--slurm-script">Extract array ID information from the <code>.slurm</code>
script<a class="anchor" aria-label="anchor" href="#extract-array-id-information-from-the--slurm-script"></a>
</h3>
<p>When submitting to the HPC cluster you’ll need to include information
about how the scheduler should distribute the simulation experiment to
the workers. In Slurm systems, you may have a script such as the
following, stored into a suitable <code>.slurm</code> file:</p>
<pre><code>#!/bin/bash
#SBATCH --job-name="My simulation (array jobs, distributing conditions + replications)"
#SBATCH --mail-type=ALL
#SBATCH --mail-user=somewhere@out.there
#SBATCH --output=/dev/null    ## (optional) delete .out files
#SBATCH --time=12:00:00       ## HH:MM:SS
#SBATCH --mem-per-cpu=4G      ## 4GB of RAM per cpu
#SBATCH --cpus-per-task=1
#SBATCH --array=1-300         ## Slurm schedulers often allow up to 10,000 arrays

module load r
Rscript --vanilla mySimDesignScript.R</code></pre>
<p>For reference later, label this file <code>simulation.slurm</code> as
this is the file that must be submitted to the scheduler when it’s
time.</p>
<p>The top part of this <code>.slurm</code> file provides the BASH
instructions for the Slurm scheduler via the <code>#SBATCH</code>
statements. In this case, how many array jobs to queue (1 through 300),
how much memory to use per job (2GB), time limits (12 hours), and more;
<a href="https://slurm.schedmd.com/sbatch.html" class="external-link">see here for SBATCH
details</a>.</p>
<p>The most important input to focus on in this context is
<strong>#SBATCH –array=1-300</strong> as this is what is used by the
Slurm scheduler to assign a unique ID to each array job. What the
scheduler does is take the defined <code>mySimDesignScript.R</code>
script and send this to 300 independent resources (each with 1 CPU and
4GB of RAM, in this case), where the independent jobs are assigned a
unique array ID number within the <code>--array=1-300</code> range
(e.g., distribution to the first computing resource would be assigned
<code>arrayID=1</code>, the second resource <code>arrayID=2</code>, and
so on). In the <code><a href="../reference/runArraySimulation.html">runArraySimulation()</a></code> function this is used
to subset the <code>Design300</code> object by row; hence, <em>the array
range must correspond to the row identifiers in the <code>design</code>
object for proper subsetting!</em></p>
<p>Collecting this single number assigned by the Slurm scheduler is also
easy. Just include</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get assigned array ID (default uses type = 'slurm')</span></span>
<span><span class="va">arrayID</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getArrayID.html">getArrayID</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>to obtain the associated array ID, which is this example will be a
single <code>integer</code> value between 1 and 300. This value is used
in the final execution step via
<code>runArraySimulation(..., arrayID=arrayID)</code>, which we finally
turn to.</p>
</div>
<div class="section level3">
<h3 id="organize-information-for-runarraysimulation">Organize information for <code>runArraySimulation()</code><a class="anchor" aria-label="anchor" href="#organize-information-for-runarraysimulation"></a>
</h3>
<p>With all the prerequisite steps in place we’re finally ready to pass
all information to <code><a href="../reference/runArraySimulation.html">runArraySimulation()</a></code>, which is
effectively a wrapper to <code><a href="../reference/runSimulation.html">runSimulation()</a></code> that suppresses
verbose outputs, takes subsets of the <code>Design300</code> object
given the supplied <code>arrayID</code> (and other objects, such as
<code>replications</code>, <code>seeds</code>, etc), forces evaluation
on a single CPU (hence, <code>#SBATCH --cpus-per-task=1</code> should be
used by default, unless there is further parallelization to occur within
the replications, such as via <code>OpenMP</code>), manages the random
number generation seeds in a tractable way, and saves the
<code>SimDesign</code> results to file names based on the
<code>filename</code> argument with suffixes associated with the
<code>arrayID</code> (e.g., <code>filename='mysim'</code> will save the
files <code>mysim-1.rds</code> for array 1, <code>mysim-2.rds</code> for
array 2, …, <code>mysim-300.rds</code> for array 300).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run the simulation on subset based on arrayID subset information</span></span>
<span><span class="fu"><a href="../reference/runArraySimulation.html">runArraySimulation</a></span><span class="op">(</span>design<span class="op">=</span><span class="va">Design300</span>, replications<span class="op">=</span><span class="va">replications</span>,</span>
<span>                   generate<span class="op">=</span><span class="va">Generate</span>, analyse<span class="op">=</span><span class="va">Analyse</span>,</span>
<span>                   summarise<span class="op">=</span><span class="va">Summarise</span>, iseed<span class="op">=</span><span class="va">iseed</span>,</span>
<span>                   arrayID<span class="op">=</span><span class="va">arrayID</span>, filename<span class="op">=</span><span class="st">'mysim'</span><span class="op">)</span></span></code></pre></div>
<p>And that’s it!</p>
<p>The above will store all the <code>mysim-#.rds</code> files in the
directory where the job was submitted, which is somewhat on the messy
side, so you may also want to specify a directory name to store the
simulation files to. Hence, on the main (i.e., landing) location
associated with your <code>ssh</code> account create a directory, using
something like <code>mkdir mysimfiles</code> (or in R,
<code>dir.create('mysimfiles')</code>) in the location where your
<code>.R</code> and <code>.slurm</code> files are stored. Then the
following can be used to store all 300 collected <code>.rds</code>
files, making use of the <code>dirname</code> argument.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run the simulation on subset based on arrayID subset information</span></span>
<span><span class="fu"><a href="../reference/runArraySimulation.html">runArraySimulation</a></span><span class="op">(</span>design<span class="op">=</span><span class="va">Design300</span>, replications<span class="op">=</span><span class="va">replications</span>,</span>
<span>                   generate<span class="op">=</span><span class="va">Generate</span>, analyse<span class="op">=</span><span class="va">Analyse</span>,</span>
<span>                   summarise<span class="op">=</span><span class="va">Summarise</span>, iseed<span class="op">=</span><span class="va">iseed</span>, arrayID<span class="op">=</span><span class="va">arrayID</span>, </span>
<span>                   dirname<span class="op">=</span><span class="st">'mysimfiles'</span>, filename<span class="op">=</span><span class="st">'mysim'</span><span class="op">)</span></span></code></pre></div>
<p>Regardless, the hard part is done here, though other information
could be included by way of the <code>control</code> list input if
necessary, such as including explicit time/resource limits in the R
executions within array jobs themselves (see the FAQ section for further
information).</p>
</div>
<div class="section level3">
<h3 id="putting-it-all-together">Putting it all together<a class="anchor" aria-label="anchor" href="#putting-it-all-together"></a>
</h3>
<p>Below is the complete submission script collecting everything that
was presented above. This assumes that</p>
<ul>
<li>The <code>.R</code> file with the simulation code is stored in the
file <code>mySimDesignScript.R</code>,</li>
<li>A suitable Slurm instruction file has been created in the file
<code>simulation.slurm</code>, which points to
<code>mySimDesignScript.R</code> and includes the relevant
<code>R</code> modules, and</li>
<li>A directory called <code>mysimfiles/</code> has been created for
storing the files on the computer used to submit the array job</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://philchalmers.github.io/SimDesign/">SimDesign</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">Design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createDesign.html">createDesign</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Generate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">condition</span>, <span class="va">fixed_objects</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">condition</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="co"># distributed N(10, 5)</span></span>
<span>    <span class="va">dat</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Analyse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">condition</span>, <span class="va">dat</span>, <span class="va">fixed_objects</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, median<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span> <span class="co"># mean/median of sample data</span></span>
<span>    <span class="va">ret</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Summarise</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">condition</span>, <span class="va">results</span>, <span class="va">fixed_objects</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># expand the design to create 300 rows with associated replications</span></span>
<span><span class="va">rc</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">Design300</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expandDesign.html">expandDesign</a></span><span class="op">(</span><span class="va">Design</span>, repeat_conditions <span class="op">=</span> <span class="va">rc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rep_target</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">replications</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">rep_target</span> <span class="op">/</span> <span class="va">rc</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Design300</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># genSeeds() # do this once on the main node/home computer, and store the number!</span></span>
<span><span class="va">iseed</span> <span class="op">&lt;-</span> <span class="fl">1276149341</span></span>
<span></span>
<span><span class="co"># get assigned array ID (default uses type = 'slurm')</span></span>
<span><span class="va">arrayID</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getArrayID.html">getArrayID</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run the simulation on subset based on arrayID subset information</span></span>
<span><span class="fu"><a href="../reference/runArraySimulation.html">runArraySimulation</a></span><span class="op">(</span>design<span class="op">=</span><span class="va">Design300</span>, replications<span class="op">=</span><span class="va">replications</span>,</span>
<span>                   generate<span class="op">=</span><span class="va">Generate</span>, analyse<span class="op">=</span><span class="va">Analyse</span>,</span>
<span>                   summarise<span class="op">=</span><span class="va">Summarise</span>, iseed<span class="op">=</span><span class="va">iseed</span>, arrayID<span class="op">=</span><span class="va">arrayID</span>, </span>
<span>                   dirname<span class="op">=</span><span class="st">'mysimfiles'</span>, filename<span class="op">=</span><span class="st">'mysim'</span><span class="op">)</span></span></code></pre></div>
<p>This file is then submitted to the job scheduler via
<code>sbatch</code>, pointing to the <code>.slurm</code>
instructions.</p>
<pre><code>sbatch simulation.slurm</code></pre>
<p>Once complete you can now go get a beer, coffee, or whatever else
tickles your fancy to celebrate as the hard part is over.</p>
</div>
</div>
<div class="section level2">
<h2 id="post-evaluation-combine-the-files">Post-evaluation: Combine the files<a class="anchor" aria-label="anchor" href="#post-evaluation-combine-the-files"></a>
</h2>
<p>After some time has elapsed, and the job evaluation is now complete,
you’ll have access to the complete set of simulation files store in the
file names <code>mysim-#.rds</code>. The final step in this process is
then to collect all independent results into a simulation object that
resembles what would have been returned from the canonical
<code><a href="../reference/runSimulation.html">runSimulation()</a></code> function. Fortunately, this is easy to do
with <code><a href="../reference/SimCollect.html">SimCollect()</a></code>. All you must do at this point is point
to the working directory containing the simulation files and use
<code><a href="../reference/SimCollect.html">SimCollect()</a></code>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://philchalmers.github.io/SimDesign/">SimDesign</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># automatically checks whether all saved files are present via SimCheck()</span></span>
<span><span class="va">Final</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SimCollect.html">SimCollect</a></span><span class="op">(</span><span class="st">'mysimfiles/'</span><span class="op">)</span></span>
<span><span class="va">Final</span></span></code></pre></div>
<pre><code># A tibble: 3 × 8
      N    mean  median REPLICATIONS   SIM_TIME  COMPLETED               
&lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;           &lt;dbl&gt;  &lt;chr&gt;     &lt;chr&gt;                   
1    10  9.9973  9.9934        10000   23.42s    Thu Apr  4 11:50:11 2024
2    20 10.007  10.015         10000   24.24s    Thu Apr  4 11:50:35 2024
3    30 10.003  10.007         10000   24.39s    Thu Apr  4 11:51:00 2024</code></pre>
<p>This function detects which <code>Design300</code> rows belong to the
original <code>Design</code> object, collapse the meta-statistic
results, and stored <code>results</code> information accordingly. No
fuss, no mess. Of course, you’ll want to store this object for later use
as this is the complete collection of the results from the 300 array
jobs, organized into one neat little (object) package.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save the aggregated simulation object for subsequent analyses</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">Final</span>, <span class="st">"../final_sim.rds"</span><span class="op">)</span></span></code></pre></div>
<p>You should now consider moving this <code>"final_sim.rds"</code> off
the Slurm landing node and onto your home computer via <code>scp</code>
or your other favourite method (e.g., using <code>WinSCP</code> on
Windows). You could also move all the saved <code>*.rds</code> files off
your ssh landing in case there is need to inspect these files further
(e.g., for debugging purposes).</p>
<hr>
</div>
<div class="section level2">
<h2 id="array-jobs-and-multicore-computing-simultaneously">Array jobs and multicore computing simultaneously<a class="anchor" aria-label="anchor" href="#array-jobs-and-multicore-computing-simultaneously"></a>
</h2>
<p>Of course, nothing really stops you from mixing and matching the
above ideas related to multicore computing and array jobs on Slurm and
other HPC clusters. For example, if you wanted to take the original
<code>design</code> object and submit batches of these instead (e.g.,
submit one or more rows of the <code>design</code> object as an array
job), where within each array multicore processing is requested, then
something like the following would work:</p>
<pre><code>#!/bin/bash
#SBATCH --job-name="My simulation (arrays + multiple CPUs)"
#SBATCH --mail-type=ALL
#SBATCH --mail-user=somewhere@out.there
#SBATCH --output=/dev/null    ## (optional) delete .out files
#SBATCH --time=04:00:00       ## HH:MM:SS
#SBATCH --mem-per-cpu=4G      ## Build a computing cluster with 64GB of RAM 
#SBATCH --cpus-per-task=16    ## 16 CPUs per array, likely built from 1 node
#SBATCH --array=1-9           ## 9 array jobs 

module load r
Rscript --vanilla mySimDesignScript.R</code></pre>
<p>with the associated <code>.R</code> file containing, in this case,
nine simulation conditions across the rows in <code>Design</code>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://philchalmers.github.io/SimDesign/">SimDesign</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">Design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createDesign.html">createDesign</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>                       SD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Generate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">condition</span>, <span class="va">fixed_objects</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">condition</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">10</span>, sd<span class="op">=</span><span class="va">SD</span><span class="op">)</span><span class="op">)</span> <span class="co"># distributed N(10, 5)</span></span>
<span>    <span class="va">dat</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Analyse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">condition</span>, <span class="va">dat</span>, <span class="va">fixed_objects</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, median<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span> <span class="co"># mean/median of sample data</span></span>
<span>    <span class="va">ret</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Summarise</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">condition</span>, <span class="va">results</span>, <span class="va">fixed_objects</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Design</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 9 × 2</span></span></span>
<span><span class="co">##       N    SD</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>    10     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>    20     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>    30     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>    10     2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>    20     2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>    30     2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span>    10     3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span>    20     3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">9</span>    30     3</span></span></code></pre>
<p>Depending on the intensity of the conditions, you may choose to
distribute more than one row of the <code>Design</code> object to each
array (<code>multirow=TRUE</code> in the following), otherwise the more
natural choice is to distribute each row in the <code>Design</code>
object to each assigned array.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get array ID</span></span>
<span><span class="va">arrayID</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getArrayID.html">getArrayID</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">multirow</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>  <span class="co"># submit multiple rows of Design object to array?</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="va">multirow</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co"># If selecting multiple design rows per array, such as the first 3 rows, </span></span>
<span>    <span class="co">#  then next 3 rows, and so on, something like the following would work</span></span>
<span>    </span>
<span>    <span class="co">## For arrayID=1, rows 1 through 3 are evaluated </span></span>
<span>    <span class="co">## For arrayID=2, rows 4 through 6 are evaluated</span></span>
<span>    <span class="co">## For arrayID=3, rows 7 through 9 are evaluated</span></span>
<span>    <span class="va">array2row</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">arrayID</span><span class="op">)</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">*</span> <span class="op">(</span><span class="va">arrayID</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># otherwise, use one row per respective arrayID</span></span>
<span>    <span class="va">array2row</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">arrayID</span><span class="op">)</span> <span class="va">arrayID</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Make sure parallel=TRUE flag is on to use all available cores! </span></span>
<span><span class="fu"><a href="../reference/runArraySimulation.html">runArraySimulation</a></span><span class="op">(</span>design<span class="op">=</span><span class="va">Design</span>, replications<span class="op">=</span><span class="fl">10000</span>, </span>
<span>                   generate<span class="op">=</span><span class="va">Generate</span>, analyse<span class="op">=</span><span class="va">Analyse</span>, summarise<span class="op">=</span><span class="va">Summarise</span>, </span>
<span>                   iseed<span class="op">=</span><span class="va">iseed</span>, dirname<span class="op">=</span><span class="st">'mysimfiles'</span>, filename<span class="op">=</span><span class="st">'mysim'</span>, </span>
<span>                   parallel<span class="op">=</span><span class="cn">TRUE</span>, arrayID<span class="op">=</span><span class="va">arrayID</span>, array2row<span class="op">=</span><span class="va">array2row</span><span class="op">)</span>  </span></code></pre></div>
<p>When complete, the function <code><a href="../reference/SimCollect.html">SimCollect()</a></code> can again be
used to put the simulation results together given the nine saved files
(nine files would also saved were <code>multirow</code> set to
<code>TRUE</code> and <code>#SBATCH --array=1-3</code> were used instead
as these are stored on a per-row basis).</p>
<p>This type of hybrid approach is a middle ground between submitting
the complete job (top of this vignette) and the <code>condition</code> +
<code>replication</code> distributed load in the previous section,
though has similar overhead + inefficiency issues as before (though less
so, as the <code>array</code> jobs are evaluated independently). Note
that if the row’s take very different amounts of time to evaluate then
this strategy can prove less efficient (e.g., the first two rows may
take 2 hours to complete, while the third row may take 12 hours to
complete), in which case a more nuanced <code>array2row()</code>
function should be defined to help explicit balance the load on the
computing cluster.</p>
</div>
<div class="section level2">
<h2 id="extra-information-faqs">Extra information (FAQs)<a class="anchor" aria-label="anchor" href="#extra-information-faqs"></a>
</h2>
<div class="section level3">
<h3 id="helpful-slurm-commands">Helpful Slurm commands<a class="anchor" aria-label="anchor" href="#helpful-slurm-commands"></a>
</h3>
<p>In addition to using <code>sbatch</code> to submit jobs, the
following contains other useful Slurm commands.</p>
<pre><code>sbatch &lt;jobfile.slurm&gt;  # submit job file to Slurm scheduler
squeue -u &lt;username&gt;    # what jobs are currently queued/running for a specific user
sshare -U &lt;username&gt;    # check the share usage for a specific user
scancel &lt;jobid&gt;         # cancel a specific job
scancel -u &lt;username&gt;   # cancel all queued and running jobs for a specific user</code></pre>
</div>
<div class="section level3">
<h3 id="my-hpc-cluster-excution-timeram-is-limited-and-terminates-before-the-simulation-is-complete">My HPC cluster excution time/RAM is limited and terminates before
the simulation is complete<a class="anchor" aria-label="anchor" href="#my-hpc-cluster-excution-timeram-is-limited-and-terminates-before-the-simulation-is-complete"></a>
</h3>
<p>This issue is important whenever the HPC cluster has mandatory
time/RAM limits for the job submissions, where the array job may not
complete within the assigned resources — hence, if not properly managed,
will discard any valid replication information when abruptly terminated.
Unfortunately, this is a very likely occurrence, and is largely a
function of being unsure about how long each simulation
condition/replication will take to complete when distributed across the
arrays (some conditions/replications will take longer than others, and
it is difficult to be perfectly knowledgeable about this information
beforehand) or how large the final objects will grow as the simulation
progresses.</p>
<p>To avoid this time/resource waste it is <strong>strongly
recommended</strong> to add a <code>max_time</code> and/or
<code>max_RAM</code> argument to the <code>control</code> list (see
<code><a href="../reference/runArraySimulation.html">help(runArraySimulation)</a></code> for supported specifications),
which are less than the Slurm specifications. These control flags will
halt the <code><a href="../reference/runArraySimulation.html">runArraySimulation()</a></code> executions early and return
only the complete simulation results up to this point. However, this
will only work if these arguments are <em>non-trivially less than the
allocated Slurm resources</em>; otherwise, you’ll run the risk that the
job terminates before the <code>SimDesign</code> functions have the
chance to store the successfully completed replications. Setting these
to around 90-95% of the respective <code>#SBATCH --time=</code> and
<code>#SBATCH --mem-per-cpu=</code> inputs should, however, be
sufficient in most cases.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Return successful results up to the 11 hour mark, and terminate early </span></span>
<span><span class="co">#   if more than 3.5 GB of RAM are required to store the internal results</span></span>
<span><span class="fu"><a href="../reference/runArraySimulation.html">runArraySimulation</a></span><span class="op">(</span>design<span class="op">=</span><span class="va">Design300</span>, replications<span class="op">=</span><span class="va">replications</span>,</span>
<span>                   generate<span class="op">=</span><span class="va">Generate</span>, analyse<span class="op">=</span><span class="va">Analyse</span>,</span>
<span>                   summarise<span class="op">=</span><span class="va">Summarise</span>, iseed<span class="op">=</span><span class="va">iseed</span>, arrayID<span class="op">=</span><span class="va">arrayID</span>, </span>
<span>                   dirname<span class="op">=</span><span class="st">'mysimfiles'</span>, filename<span class="op">=</span><span class="st">'mysim'</span>,</span>
<span>                   control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>max_time<span class="op">=</span><span class="st">"11:00:00"</span>, max_RAM<span class="op">=</span><span class="st">"3.5GB"</span><span class="op">)</span><span class="op">)</span>   </span></code></pre></div>
<p>Of course, if the session does time out early then this implies that
the target <code>replications</code> will be missed on the first job
submission batch. Therefore, and as is covered in the next section, a
new job must be submitted to the scheduler that is mindful of the
initial simulation history (particularly, the <code>.Random.seed</code>
states).</p>
</div>
<div class="section level3">
<h3 id="uploading-array-jobs-related-to-previous-array-submissions">Uploading array jobs related to previous array submissions<a class="anchor" aria-label="anchor" href="#uploading-array-jobs-related-to-previous-array-submissions"></a>
</h3>
<p>Related to early termination issue above is what to do about the
missing replication information in the event that the complete set of
replication information has not been collected. Obtaining the missing
information clearly requires a second (or third) submission of the
simulation job, though obviously only for the conditions where the
collected replication results were problematic. Moreover, this has to be
performed with care to avoid redundant random data generation strings,
ultimately resulting in sub-optimal results.</p>
<p>To start, locate the simulation conditions in the aggregated result
that do not meet the target replication criteria. This could be obtained
via inspection of the aggregated results</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Final</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SimCollect.html">SimCollect</a></span><span class="op">(</span><span class="st">'mysimfiles/'</span><span class="op">)</span></span>
<span><span class="va">Final</span></span></code></pre></div>
<pre><code># A tibble: 3 × 8
      N    mean  median REPLICATIONS   SIM_TIME  COMPLETED               
&lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;           &lt;dbl&gt;  &lt;chr&gt;     &lt;chr&gt;                   
1    10  9.9973  9.9934         9000   23.42s    Thu Apr  4 11:50:11 2024
2    20 10.007  10.015         10000   24.24s    Thu Apr  4 11:50:35 2024
3    30 10.003  10.007          8000   24.39s    Thu Apr  4 11:51:00 2024</code></pre>
<p>or via the more informative (and less memory intensive)
<code>SimCollect(..., check.only=TRUE)</code> flag.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Missed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SimCollect.html">aggregate_simulations</a></span><span class="op">(</span>files<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="op">)</span>, check.only<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Missed</span></span></code></pre></div>
<pre><code># A tibble: 4 × 3
      N MISSED_REPLICATIONS TARGET_REPLICATIONS
  &lt;dbl&gt;               &lt;int&gt;               &lt;int&gt;
1    10                1000               10000
2    30                2000               10000</code></pre>
<p>Next, build a new simulation structure containing only the missing
information components.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subDesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Missed</span>, select<span class="op">=</span><span class="va">N</span><span class="op">)</span></span>
<span><span class="va">replications_missed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Missed</span>, select<span class="op">=</span><span class="va">MISSED_REPLICATIONS</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subDesign</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 1</span></span></span>
<span><span class="co">##       N</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>    30</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">replications_missed</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1000 2000</span></span></code></pre>
<p>At this point, you can return to the above logic of organizing the
simulation script job, distributing the information across as many array
jobs as necessary to fill in the missing information. However, as before
you must be <em>very careful</em> about the random number generators per
row in <code>subDesign</code> <strong>and</strong> the original
submission job. The fix in this case is straightforward as well: simply
create a continuation from the previous logic, where the new elements
are treated as additional rows in the resulting object as though they
were part of the initial job submission.</p>
<p>So, we now just glue on the new <code>subDesign</code> information to
the original expanded version, though telling the scheduler to only
evaluate these new rows in the <code>#SBATCH --array</code>
specification (this is technically unnecessary, but is conceptually
clear and keeps all simulation files and array IDs consistent).</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rc</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">Design_left</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expandDesign.html">expandDesign</a></span><span class="op">(</span><span class="va">subDesign</span>, <span class="va">rc</span><span class="op">)</span> <span class="co"># smaller number of reps per array</span></span>
<span><span class="va">Design_left</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 100 × 1</span></span></span>
<span><span class="co">##        N</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>    10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>    10</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 90 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">replications_left</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">replications_missed</span><span class="op">/</span><span class="va">rc</span>, each<span class="op">=</span><span class="va">rc</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">replications_left</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## replications_left</span></span>
<span><span class="co">## 20 40 </span></span>
<span><span class="co">## 50 50</span></span></code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># new total design and replication objects</span></span>
<span><span class="va">Design_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">Design300</span>, <span class="va">Design_left</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Design_total</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 400</span></span></code></pre>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">replications_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">replications</span>, <span class="va">replications_left</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">replications_total</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## replications_total</span></span>
<span><span class="co">##  20  40 100 </span></span>
<span><span class="co">##  50  50 300</span></span></code></pre>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># this *must* be the same as the original submission!</span></span>
<span><span class="va">iseed</span> <span class="op">&lt;-</span> <span class="fl">1276149341</span></span></code></pre></div>
<p>Again, this approach simply expands the original simulation with 300
array jobs to one with 400 array jobs as though the added structure was
an intended part of the initial design (which is obviously wasn’t, but
is organized as such).</p>
<p>Finally, in the <code>.slurm</code> submission file you no longer
want to evaluate the first 1-300 cases, as these <code>.rds</code> files
have already been evaluated, and instead want to change the
<code>--array</code> line from</p>
<pre><code><span><span class="co">#SBATCH --array=1-300</span></span></code></pre>
<p>to</p>
<pre><code><span><span class="co">#SBATCH --array=301-400</span></span></code></pre>
<p>Submit this job to compute all the missing replication information,
which stores these files into the same working directory but with the
new information stored as <code>mysim-301.rds</code> through
<code>mysim-400.rds</code>. In this example, there will now be a total
of 400 files that have been saved. Once complete, run</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># See if any missing still</span></span>
<span><span class="fu"><a href="../reference/SimCollect.html">SimCollect</a></span><span class="op">(</span><span class="st">'mysimfiles'</span>, check.only<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Obtain complete simulation results</span></span>
<span><span class="va">Final</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SimCollect.html">SimCollect</a></span><span class="op">(</span><span class="st">'mysimfiles'</span><span class="op">)</span></span></code></pre></div>
<p>one last time, which now reads in the complete set of 400 stored
files instead of the previous 300, thereby obtaining the complete set of
high-quality simulation results. Rinse and repeat if the same issue
appears yet again on the second submission.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Phil Chalmers.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>

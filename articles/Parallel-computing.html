<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Parallel computing information • SimDesign</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Parallel computing information">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SimDesign</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.18.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Catch_errors.html">Managing warning and error messages</a></li>
    <li><a class="dropdown-item" href="../articles/Fixed_obj_fun.html">Exporting objects and functions from the workspace</a></li>
    <li><a class="dropdown-item" href="../articles/HPC-computing.html">Distributing jobs for high-performance computing (HPC) clusters (e.g., via Slurm)</a></li>
    <li><a class="dropdown-item" href="../articles/MultipleAnalyses.html">Multiple analysis functions</a></li>
    <li><a class="dropdown-item" href="../articles/Parallel-computing.html">Parallel computing information</a></li>
    <li><a class="dropdown-item" href="../articles/Saving-results.html">Saving simulation results and state</a></li>
    <li><a class="dropdown-item" href="../articles/SimDesign-intro.html">Introduction to the SimDesign package</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/philchalmers/SimDesign/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Parallel computing information</h1>
                        <h4 data-toc-skip class="author">Phil
Chalmers</h4>
            
            <h4 data-toc-skip class="date">2025-03-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/philchalmers/SimDesign/blob/main/vignettes/Parallel-computing.Rmd" class="external-link"><code>vignettes/Parallel-computing.Rmd</code></a></small>
      <div class="d-none name"><code>Parallel-computing.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The purpose of this vignette is to highlight some of the internally
defined structures that <code>SimDesign</code> supports for distributing
the simulation experiment across computing cores, networks, and
clusters. In particular, this document includes how the
<code><a href="../reference/runSimulation.html">runSimulation()</a></code> function distributes the workload across
the <code>replications</code> on a per simulation condition basis.
Hence, the <code>replcations</code> in each each row experiment defined
within the <code>design</code> object is distributed in parallel, which
ensures that the independent replications within each condition follow
proper random number generation control.</p>
<p>The logic presented within this document is based on the notion that
the front-end user has, in principle, access to each of the computing
cores (e.g., can be connected via <code>ssh</code>, or are available
locally), and that each simulation condition defined in the
<code>design</code> object reflect independent experiments (default when
using <code><a href="../reference/createDesign.html">createDesign()</a></code>; see <code><a href="../reference/expandDesign.html">expandDesign()</a></code> for
the non-independent structure that would not be supported by the
approaches described in this document). For situations where the
computing architecture is not directly available, such as on high
performance computing (HPC) super computers, or simply by picking
independent computers and running batches of the simulation code on each
computer (with the purpose of collapsing later via
<code><a href="../reference/SimCollect.html">aggregate_simulations()</a></code>), see the vignette
<em>“Distributing jobs for high-performance computing (HPC)”</em> as
managing the random number generation will require additional care.</p>
<div class="section level3">
<h3 id="local-parallel-computing">Local parallel computing<a class="anchor" aria-label="anchor" href="#local-parallel-computing"></a>
</h3>
<p>By default, <code>SimDesign</code>’s <code><a href="../reference/runSimulation.html">runSimulation()</a></code>
function is executed with only a single core. However, setting the
argument <code>runSimulation(..., parallel = TRUE)</code> will
automatically define a cluster object using one core less than the
system has available (detect via
<code><a href="https://parallelly.futureverse.org/reference/availableCores.html" class="external-link">parallelly::availableCores()</a></code>). This allows a
straightforward way to construct a suitable, locally supported cluster
object for parallel processing on just the active computer. Depending on
the <code>verbose</code> and <code>progress</code> flags, the progress
of each distributed replication will also be printed to the console to
indicate the amount of estimated time remaining for the selection
simulation condition to complete. This process is then repeated again
for each condition in the supplied <code>design</code> object until all
rows have been evaluated.</p>
<p>This setup is the most painless way to construct and distribute the
independent replications per condition, where within each evaluated
condition (i.e., each row of the <code>design</code> object)
high-quality random numbers are automatically used via Pierre L’Ecuyer’s
(1999) multiple streams method, limited only by the number of cores that
are available. Alternatively, though with a bit of extra effort, users
may also define their own cluster computing object by way of the
<code>runSimulation(..., cl)</code> object, which can be used to link
computing resources that are able to communicate via <code>ssh</code>,
thereby expanding the number of available computing cores detected by
<code><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">parallel::detectCores()</a></code> and friends.</p>
</div>
<div class="section level3">
<h3 id="network-computing">Network computing<a class="anchor" aria-label="anchor" href="#network-computing"></a>
</h3>
<p>If you access have to a set of computers which can be linked via
secure-shell (<code>ssh</code>) on the same LAN network then Network
computing (a.k.a., a Beowulf cluster) may be a viable and useful option.
The setup generally requires that the master node has
<code>SimDesign</code> installed, and the slave/master nodes have all
the required R packages pre-installed (Unix utilities such as
<code>dsh</code> are very useful for this purpose). Finally, the master
node must have <code>ssh</code> access to the slave nodes, each slave
node must have <code>ssh</code> access with the master node, and a
cluster object (<code>cl</code>) from the <code>parallel</code> package
must be manually defined on the master node.</p>
<p>Setup for network computing is generally straightforward in that it
only requires the specification of a) the respective IP addresses within
a defined R script, and b) the user name (if different from the master
node’s user name; otherwise, only a) is required). On Linux, it may also
be important to include relevant information about the host names and IP
addresses in the <code>/etc/hosts</code> file on the master and slave
nodes, and to ensure that the selected port (passed to
<code><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">parallel::makeCluster()</a></code>) on the master node is not hindered
by a firewall.</p>
<p>As an example, using the following code the master (primary) node
will spawn 7 slave (secondary) and 1 master node, while a separate
computer on the network with the associated IP address will spawn an
additional 6 slave nodes. Information will be collected on the master
node, which is also where the files and objects will be saved using the
associated <code>save</code>/<code>filename</code> inputs in
<code><a href="../reference/runSimulation.html">runSimulation()</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span><span class="va">primary</span> <span class="op">&lt;-</span> <span class="st">'192.168.2.1'</span></span>
<span><span class="va">IPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>host<span class="op">=</span><span class="va">primary</span>, user<span class="op">=</span><span class="st">'myname'</span>, ncore<span class="op">=</span><span class="fl">8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>host<span class="op">=</span><span class="st">'192.168.2.2'</span>, user<span class="op">=</span><span class="st">'myname'</span>, ncore<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">IPs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">IP</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>host<span class="op">=</span><span class="va">IP</span><span class="op">$</span><span class="va">host</span>, user<span class="op">=</span><span class="va">IP</span><span class="op">$</span><span class="va">user</span><span class="op">)</span><span class="op">)</span>, <span class="va">IP</span><span class="op">$</span><span class="va">ncore</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">spec</span>, recursive<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span>master<span class="op">=</span><span class="va">primary</span>, spec<span class="op">=</span><span class="va">spec</span>, type <span class="op">=</span> <span class="st">'PSOCK'</span><span class="op">)</span></span>
<span><span class="va">Final</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runSimulation.html">runSimulation</a></span><span class="op">(</span><span class="va">...</span>, cl<span class="op">=</span><span class="va">cl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span></code></pre></div>
<p>The object <code>cl</code> is passed to <code><a href="../reference/runSimulation.html">runSimulation()</a></code>
on the master node and the computations are distributed across the
respective IP addresses. Finally, it’s usually good practice to use
<code>stopCluster(cl)</code> when all the simulations are said and done
to release the communication between the computers, which is what the
above code shows.</p>
<p>If you have provided suitable names for each respective slave node,
as well as the master, then you can define the <code>cl</code> object
using these instead (rather than supplying the IP addresses in your R
script). This requires that the master node has itself and all the slave
nodes defined in the <code>/etc/hosts</code> and
<code>~/.ssh/config</code> files, while the slave nodes require
themselves and the master node in the same files (only 2 IP addresses
required on each slave). Following this setup, and assuming the user
name is the same across all nodes, the <code>cl</code> object could
instead be defined with</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span><span class="va">primary</span> <span class="op">&lt;-</span> <span class="st">'master'</span></span>
<span><span class="va">IPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>host<span class="op">=</span><span class="va">primary</span>, ncore<span class="op">=</span><span class="fl">8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>host<span class="op">=</span><span class="st">'slave'</span>, ncore<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">IPs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">IP</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>host<span class="op">=</span><span class="va">IP</span><span class="op">$</span><span class="va">host</span><span class="op">)</span><span class="op">)</span>, <span class="va">IP</span><span class="op">$</span><span class="va">ncore</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">spec</span>, recursive<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span>master<span class="op">=</span><span class="va">primary</span>, spec<span class="op">=</span><span class="va">spec</span>, type <span class="op">=</span> <span class="st">'PSOCK'</span><span class="op">)</span></span>
<span><span class="va">Final</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runSimulation.html">runSimulation</a></span><span class="op">(</span><span class="va">...</span>, cl<span class="op">=</span><span class="va">cl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span></code></pre></div>
<p>As was the case with the local cluster definition in the first
section, random numbers are automatically organized via Pierre
L’Ecuyer’s (1999) method to ensure quality number generation. A similar
setup can also be used via the recently supported <code>future</code>
interface (see below).</p>
</div>
<div class="section level3">
<h3 id="using-the-future-framework">Using the <code>future</code> framework<a class="anchor" aria-label="anchor" href="#using-the-future-framework"></a>
</h3>
<p>The <code>future</code> framework (see
<code><a href="https://future.futureverse.org/reference/future.html" class="external-link">help(future, package = 'future')</a></code>) can also be used for
distributing the asynchronous function evaluations for each simulation
replication by changing the logical input in
<code>runSimulation(..., parallel = TRUE/FALSE)</code> to the character
vector <code>runSimulation(..., parallel = 'future')</code>. For this to
work, the computation plan must be pre-specified via
<code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan()</a></code>. For example, to initialize a local
two-worker parallel processing computational plan one can use the
follow:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runSimulation.html">runSimulation</a></span><span class="op">(</span>design<span class="op">=</span><span class="va">Design</span>, replications<span class="op">=</span><span class="fl">1000</span>, generate<span class="op">=</span><span class="va">Generate</span>, </span>
<span>                     analyse<span class="op">=</span><span class="va">Analyse</span>, summarise<span class="op">=</span><span class="va">Summarise</span>,</span>
<span>                     parallel <span class="op">=</span> <span class="st">'future'</span><span class="op">)</span></span></code></pre></div>
<p>The benefit of using the <code>future</code> framework is the
automatic support of many distinct back-ends, such as, for instance, HPC
clusters that control the distribution of jobs via Slurm or TORQUE
(e.g., see the <code>future.batchtools</code> package).</p>
<p>For progress reporting the <code>progressr</code> package is required
and is intended as a wrapper around <code><a href="../reference/runSimulation.html">runSimulation()</a></code>.
Specifically, wrap the function <code><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress()</a></code> around
<code><a href="../reference/runSimulation.html">runSimulation()</a></code> after having specified the type of
<code>handler()</code> to use, such as via the following.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://progressr.futureverse.org" class="external-link">progressr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rstudio style handler (if using RStudio)</span></span>
<span><span class="fu"><a href="https://progressr.futureverse.org/reference/handlers.html" class="external-link">handlers</a></span><span class="op">(</span><span class="st">"rstudio"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># or using the cli package for terminal-based progress </span></span>
<span><span class="fu"><a href="https://progressr.futureverse.org/reference/handlers.html" class="external-link">handlers</a></span><span class="op">(</span><span class="st">'cli'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># See help(progressr) for additional options and details</span></span>
<span></span>
<span><span class="co"># to use progressr, wrap/pipe inside with_progress() </span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress</a></span><span class="op">(</span><span class="fu"><a href="../reference/runSimulation.html">runSimulation</a></span><span class="op">(</span>design<span class="op">=</span><span class="va">Design</span>, replications<span class="op">=</span><span class="fl">1000</span>, generate<span class="op">=</span><span class="va">Generate</span>, </span>
<span>                     analyse<span class="op">=</span><span class="va">Analyse</span>, summarise<span class="op">=</span><span class="va">Summarise</span>,</span>
<span>                     parallel <span class="op">=</span> <span class="st">'future'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Finally, when the parallel computations are complete be sure to
manually reset the computation plan to free any workers via</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">sequential</span><span class="op">)</span> <span class="co"># release workers</span></span></code></pre></div>
<p>The benefit of the future framework is that it provides a unified
distribution framework for parallel (multisession, multicore, cluster)
and non-parallel (sequential) processing, manages random number
generation correctly for Monte Carlo simulations, and as demonstrated
above has a wide variety of tools that can be applied to a interactive
sessions.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Phil Chalmers.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
